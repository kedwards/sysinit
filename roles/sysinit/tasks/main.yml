---
- name: Set user configuration
  ansible.builtin.set_fact:
    sysinit_user: "{{ lookup('env', 'USER') }}"
    sysinit_user_home: "{{ lookup('env', 'HOME') }}"

- name: Display system info
  ansible.builtin.debug:
    msg:
      - "User: {{ sysinit_user }}"
      - "Home: {{ sysinit_user_home }}"
      - "System: {{ ansible_facts['system'] }}"
      - "Architecture: {{ ansible_facts['architecture'] }}"
      - "OS Family: {{ ansible_facts['os_family'] }}"
      - "Distribution: {{ ansible_facts['distribution'] }}"
      - "Release: {{ ansible_facts['distribution_release'] }}"
      - "Sysinit: {{ sysinit_var }}"

- name: Load distribution variables
  ansible.builtin.include_vars: "{{ ansible_facts['distribution'] }}.yml"

- name: Combine tools lists
  ansible.builtin.set_fact:
    sysinit_combined_tools: >
      {{ (sysinit_tools | default([])) +
         (sysinit_sys_tools | default([])) +
         (tools | default('') | split(',')) |
         select('match', '.+') | list }}

- name: Install system packages
  ansible.builtin.package:
    name: "{{ sysinit_packages + sysinit_distro_packages | default([]) }}"
    state: present

- name: Install tools
  ansible.builtin.include_tasks: "tools/{{ item }}.yml"
  loop: "{{ sysinit_combined_tools | default([]) }}"
  when: sysinit_combined_tools is defined and sysinit_combined_tools | length > 0
