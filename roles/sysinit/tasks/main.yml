---
- name: Display system info
  ansible.builtin.debug:
    msg:
      - "User: {{ lookup('env', 'USER') }}"
      - "Home: {{ lookup('env', 'HOME') }}"
      - "System: {{ ansible_system }}"
      - "Architecture: {{ ansible_userspace_architecture }}"
      - "OS Family: {{ ansible_os_family }}"
      - "Distribution: {{ ansible_distribution }}"
      - "Release: {{ ansible_distribution_release }}"
      - "Sysinit: {{ sysinit_var }}"

- name: Load distribution variables
  ansible.builtin.include_vars: "{{ ansible_distribution }}.yml"

- name: Combine tools lists
  ansible.builtin.set_fact:
    sysinit_combined_tools: "{{ (sysinit_sys_tools | default([])) + (sysinit_tools | default([])) + (tools | default('') | split(',')) | select('match', '.+') | list }}"

- name: Install system packages
  ansible.builtin.package:
    name: "{{ sysinit_packages + sysinit_distro_packages | default([]) }}"
    state: present

- name: Install tools
  ansible.builtin.include_tasks: "tools/{{ item }}.yml"
  loop: "{{ sysinit_combined_tools | default([]) }}"
  when: sysinit_combined_tools is defined and sysinit_combined_tools | length > 0
