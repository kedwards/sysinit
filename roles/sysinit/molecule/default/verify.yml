---
- name: Verify
  hosts: all
  become: true
  gather_facts: false
  tasks:
    - name: Verify system packages are installed
      ansible.builtin.package_facts:
      register: package_facts

    - name: Check that basic tools are installed
      ansible.builtin.stat:
        path: "{{ item }}"
      register: tool_check
      failed_when: not tool_check.stat.exists
      loop:
        - /usr/local/bin/starship
        - /usr/local/bin/aws-vault
      when: "'starship' in tools or 'aws-vault' in tools"

    - name: Verify tools are executable
      ansible.builtin.command: "{{ item }} --version"
      register: version_check
      failed_when: version_check.rc != 0
      changed_when: false
      loop:
        - /usr/local/bin/starship
        - /usr/local/bin/aws-vault
      when: "'starship' in tools or 'aws-vault' in tools"
