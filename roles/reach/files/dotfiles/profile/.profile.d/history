# Enable autocd (implicit `cd` when typing a directory)
if [[ -n "$BASH_VERSION" ]]; then
  shopt -s autocd 2>/dev/null
elif [[ -n "$ZSH_VERSION" ]]; then
  setopt autocd extendedglob
fi

# Enable recursive globbing (** to match subdirectories)
if [[ -n "$BASH_VERSION" ]]; then
  shopt -s globstar 2>/dev/null
elif [[ -n "$ZSH_VERSION" ]]; then
  setopt GLOBSTARSHORT
fi

# Enable multi-line commands in history
if [[ -n "$BASH_VERSION" ]]; then
  shopt -s cmdhist
  # Prevent duplicate lines and lines starting with space from being recorded in history
  export HISTCONTROL="erasedups:ignoreboth" # Bash only
  export HISTIGNORE="&:[ ]*:exit:ls:bg:fg:history"

elif [[ -n "$ZSH_VERSION" ]]; then
  setopt HIST_IGNORE_SPACE      # Ignore commands that start with a space
  setopt HIST_IGNORE_DUPS       # Ignore duplicates
  setopt HIST_SAVE_NO_DUPS      # Do not save duplicates
  setopt HIST_FIND_NO_DUPS      # Prevent duplicate matches in history search
  setopt INC_APPEND_HISTORY     # Append commands as they are executed
  setopt HIST_EXPIRE_DUPS_FIRST # Remove oldest duplicate when history is full
  zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
fi

# Append to history file instead of overwriting
if [[ -n "$BASH_VERSION" ]]; then
  shopt -s histappend
elif [[ -n "$ZSH_VERSION" ]]; then
  setopt APPEND_HISTORY
  setopt INC_APPEND_HISTORY # Write history incrementally
  setopt SHARE_HISTORY      # Share history between sessions
fi

# Set history size
export HISTSIZE=500000
export HISTFILESIZE=100000

# Set history timestamp format
if [[ -n "$BASH_VERSION" ]]; then
  export HISTTIMEFORMAT='%F %T '
elif [[ -n "$ZSH_VERSION" ]]; then
  export HIST_STAMPS="yyyy-mm-dd"
fi

# Automatically trim long paths in the prompt (only works in Bash 4.x+)
if [[ -n "$BASH_VERSION" ]]; then
  PROMPT_DIRTRIM=2
elif [[ -n "$ZSH_VERSION" ]]; then
  setopt PROMPT_SUBST # Allow prompt modifications
  PROMPT='%~%# '      # Shorten path in prompt (~ replaces $HOME)
fi
